"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseMongoshArgs = parseMongoshArgs;
const i18n_1 = __importDefault(require("@mongosh/i18n"));
const arg_parser_1 = require("@mongosh/arg-parser/arg-parser");
const clr_1 = require("./clr");
const constants_1 = require("./constants");
const errors_1 = require("@mongosh/errors");
const parseArgsWithCliOptions = (0, arg_parser_1.createParseArgsWithCliOptions)();
const UNKNOWN = 'cli-repl.arg-parser.unknown-option';
function parseMongoshArgs(argsWithProgram) {
    try {
        const args = argsWithProgram.slice(2);
        i18n_1.default.setLocale((0, arg_parser_1.getLocale)(argsWithProgram, process.env));
        const { parsed, deprecated } = parseArgsWithCliOptions({ args });
        const warnings = Object.entries(deprecated).map(([deprecated, replacement]) => `WARNING: argument --${deprecated} is deprecated and will be removed. Use --${replacement} instead.`);
        return {
            parsed,
            warnings,
        };
    }
    catch (error) {
        if (error instanceof arg_parser_1.UnsupportedArgumentError) {
            throw new errors_1.MongoshUnimplementedError(`Argument --${error.argument} is not supported in mongosh`, errors_1.CommonErrors.InvalidArgument);
        }
        if (error instanceof arg_parser_1.UnknownArgumentError) {
            throw new errors_1.MongoshUnimplementedError(`  ${(0, clr_1.colorizeForStderr)(i18n_1.default.__(UNKNOWN), 'mongosh:error')} ${(0, clr_1.colorizeForStderr)(String(error.argument), 'bold')}
        ${constants_1.USAGE}`, errors_1.CommonErrors.InvalidArgument);
        }
        throw error;
    }
}
//# sourceMappingURL=arg-parser.js.map